<!-- Search Food -->
<%# <h5>Search Food</h5> %>
<%= form_with url: search_macros_path, method: :get, local: true do |form| %>
  <%= hidden_field_tag :meal, params[:meal] %>
  <%= hidden_field_tag :date, params[:date] %>
  <%= form.label :query, "Search for food:" %>
  <%= form.text_field :query %>
  <%= form.submit "Search" %>
<% end %>

<% if @results.present? %>
  <ul>
    <% @results.each do |food| %>
      <li><strong><%= food["food_name"] %></strong> - <%= food["food_description"] %></li>
      <% @food_name = food["food_name"]
          description = food["food_description"]

          @calories = description[/Calories:\s([\d.]+)kcal/, 1].to_f
          @protein = description[/Protein:\s([\d.]+)g/, 1].to_f
          @carbohydrates = description[/Carbs:\s([\d.]+)g/, 1].to_f
          @fats = description[/Fat:\s([\d.]+)g/, 1].to_f 
      %>

      <%= button_to "✚", add_meal_macros_path, method: :post, 
        params: {macro: {
          user_id: @user_id,
          name: @food_name,
          calories: @calories, 
          protein: @protein,
          carbohydrates: @carbohydrates,
          fats: @fats,
          meal: @meal_type,
          logged_date: @logged_date,
        } }%>
    <% end %>
  </ul>
<% elsif params[:query].present? %>
  <p>No results found for "<%= params[:query] %>". FatSecret API temporarily unavailable — please enter meals manually.</p>
<% end %>

<%= link_to "Back", macros_path(logged_date: @logged_date) %>
<br>
<br>


